<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Angular主题方案 · Jason Tsang</title><meta name="description" content="Angular主题方案 - Jason Tsang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://jasontsang.dev/atom.xml" title="Jason Tsang"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Jason Tsang" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/gnastnosaj" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/lab" target="_self" class="nav-list-link">LAB</a></li><li class="nav-list-item"><a href="/resume/" target="_self" class="nav-list-link">RESUME</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Angular主题方案</h1><div class="post-info">May 28, 2019</div><div class="post-content"><h1 id="基于NgClass的主题切换"><a href="#基于NgClass的主题切换" class="headerlink" title="基于NgClass的主题切换"></a>基于NgClass的主题切换</h1><p>Angular常见的主题方案是将组件设置NgClass属性并动态绑定主题class，通过编写对应class的样式以及切换class来达到切换主题的目的。为了简化实践，我们可以将此过程封装成一个Directive。</p>
<p>参考代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BehaviorSubject &#125; from &#x27;rxjs&#x27;;</span><br><span class="line"></span><br><span class="line">//主题Subject</span><br><span class="line">const theme: BehaviorSubject&lt;string&gt; = new BehaviorSubject(null);</span><br><span class="line"></span><br><span class="line">//所有主题数组</span><br><span class="line">const themes: Array&lt;string&gt; = [];</span><br><span class="line"></span><br><span class="line">//订阅主题Subject，将主题class应用到body</span><br><span class="line">theme.subscribe(c =&gt; &#123;</span><br><span class="line">    themes.forEach(t =&gt; &#123;</span><br><span class="line">        if (t === c) &#123;</span><br><span class="line">            document.body.classList.add(t);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            document.body.classList.remove(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//注册主题</span><br><span class="line">function registerThemes(...themesToRegister: Array&lt;string&gt;) &#123;</span><br><span class="line">    themes.push(...themesToRegister);</span><br><span class="line">    if (theme.value == null) &#123;</span><br><span class="line">        theme.next(themesToRegister[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import &#123; Directive, ElementRef &#125; from &#x27;@angular/core&#x27;;</span><br><span class="line"></span><br><span class="line">//主题Directive，将主题class应用到对应元素</span><br><span class="line">@Directive(&#123;</span><br><span class="line">    selector: &#x27;[ngCariTheme]&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">export class ThemeDirective &#123;</span><br><span class="line">    constructor(el: ElementRef) &#123;</span><br><span class="line">        theme.subscribe(c =&gt; &#123;</span><br><span class="line">            themes.forEach(t =&gt; &#123;</span><br><span class="line">                if (t === c) &#123;</span><br><span class="line">                    el.nativeElement.classList.add(t);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    el.nativeElement.classList.remove(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方式</p>
<ol>
<li>应用初始化时调用registerThemes注册所有主题</li>
<li>在对应的组件上添加ngCariTheme属性来绑定主题class</li>
<li>编写对应class样式</li>
<li>最后通过theme.next(‘theme’)切换主题。</li>
</ol>
<h1 id="NG-ZORRO主题切换"><a href="#NG-ZORRO主题切换" class="headerlink" title="NG-ZORRO主题切换"></a>NG-ZORRO主题切换</h1><p>基于NgClass的主题切换虽然能实现我们想要的效果，但是想要修改整体效果却需要耗费很大的工作量，考虑到目前项目中使用了NG-ZORRO组件与样式库，可以采用先切换NG-ZORRO主题再调整部分主题细节的方案。</p>
<p>实现整体切换NG-ZORRO主题有两种方案，第一种是预先将多种主题less编译成css并以静态资源的方式来进行打包处理，在应用加载时动态加载对应主题的css，第二种方案是将多种主题的less文件以静态资源的方式来进行打包处理，在应用加载时动态编译less并应用到全局样式。考虑到我们目前的项目最终以C的形态呈现，不存在网络延迟导致静态资源加载速度过慢的问题，所以采用第二种方案，以达到简便灵活的目的。</p>
<p>参考代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//主题节点元素</span><br><span class="line">style = null;</span><br><span class="line">//缓存主题css样式</span><br><span class="line">styles = &#123;&#125;;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">//订阅主题切换</span><br><span class="line">theme.subscribe(t =&gt; &#123;</span><br><span class="line">  if (t != null) &#123;</span><br><span class="line">    //创建主题节点元素</span><br><span class="line">    if (this.style == null) &#123;</span><br><span class="line">      this.style = document.createElement(&#x27;style&#x27;);</span><br><span class="line">      this.style.setAttribute(&#x27;type&#x27;, &#x27;text/css&#x27;);</span><br><span class="line">      document.head.appendChild(this.style);</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.styles[t]) &#123;</span><br><span class="line">      //应用缓存主题css样式</span><br><span class="line">      this.style.innerHTML = this.styles[t];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      //动态编译主题less并缓存</span><br><span class="line">      less.render(`@import &quot;/theme/$&#123;t&#125;.less&quot;;`, &#123;</span><br><span class="line">        javascriptEnabled: true</span><br><span class="line">      &#125;).then(output =&gt; &#123;</span><br><span class="line">        this.style.innerHTML = output.css;</span><br><span class="line">        this.styles[t] = output.css;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//注册主题</span><br><span class="line">registerThemes(&#x27;light&#x27;, &#x27;dark&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/angular-rxbus/" class="prev">上一篇</a><a href="/gitlab-runner-with-sonarqube/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2024 <a href="https://jasontsang.dev">Jason Tsang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>